(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(a=o.key,i=void 0,i=function(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(a,"string"),"symbol"===e(i)?i:String(i)),o)}var a,i}const n=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loader=t,this.url=n,this.t=r}var n,r,o;return n=e,(r=[{key:"upload",value:function(){var e=this;return this.loader.file.then((function(t){return new Promise((function(n,r){e._initRequest(),e._initListeners(n,r,t),e._sendRequest(t)}))}))}},{key:"abort",value:function(){this.xhr&&this.xhr.abort()}},{key:"_initRequest",value:function(){var e=this.xhr=new XMLHttpRequest;e.open("POST",this.url,!0),e.responseType="json"}},{key:"_initListeners",value:function(e,t,n){var r=this.xhr,o=this.loader,a=(0,this.t)("Cannot upload file:")+" ".concat(n.name,".");r.addEventListener("error",(function(){return t(a)})),r.addEventListener("abort",(function(){return t()})),r.addEventListener("load",(function(){var n=r.response;if(!n||!n.uploaded)return t(n&&n.error&&n.error.message?n.error.message:a);e({default:n.url})})),r.upload&&r.upload.addEventListener("progress",(function(e){e.lengthComputable&&(o.uploadTotal=e.total,o.uploaded=e.loaded)}))}},{key:"_sendRequest",value:function(e){var t=new FormData;t.append("upload",e),t.append("_token",$('meta[name="csrf-token"]').attr("content")),this.xhr.send(t)}}])&&t(n.prototype,r),o&&t(n,o),Object.defineProperty(n,"prototype",{writable:!1}),e}();function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===r(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var r=document.querySelector("#"+e);window.EDITOR&&EDITOR.CKEDITOR[e]||ClassicEditor.create(r,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({fontSize:{options:[9,11,13,"default",17,16,18,19,21,22,23,24]},alignment:{options:["left","right","center","justify"]},heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"Heading 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"Heading 4",class:"ck-heading_heading4"}]},placeholder:" ",toolbar:{items:["heading","|","fontColor","fontSize","fontBackgroundColor","fontFamily","bold","italic","underline","link","strikethrough","bulletedList","numberedList","|","alignment","direction","outdent","indent","|","htmlEmbed","imageInsert","blockQuote","insertTable","mediaEmbed","undo","redo","findAndReplace","removeFormat","sourceEditing","codeBlock"]},language:{ui:"en",content:window.siteEditorLocale||"en"},image:{toolbar:["imageTextAlternative","imageStyle:inline","imageStyle:block","imageStyle:side","toggleImageCaption","ImageResize"],upload:{types:["jpeg","png","gif","bmp","webp","tiff","svg+xml"]}},codeBlock:{languages:[{language:"plaintext",label:"Plain text"},{language:"c",label:"C"},{language:"cs",label:"C#"},{language:"cpp",label:"C++"},{language:"css",label:"CSS"},{language:"diff",label:"Diff"},{language:"html",label:"HTML"},{language:"java",label:"Java"},{language:"javascript",label:"JavaScript"},{language:"php",label:"PHP"},{language:"python",label:"Python"},{language:"ruby",label:"Ruby"},{language:"typescript",label:"TypeScript"},{language:"xml",label:"XML"},{language:"dart",label:"Dart",class:"language-dart"}]},link:{defaultProtocol:"http://",decorators:{openInNewTab:{mode:"manual",label:"Open in a new tab",attributes:{target:"_blank",rel:"noopener noreferrer"}}}},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells","tableCellProperties","tableProperties"]},htmlSupport:{allow:[{name:/.*/,attributes:!0,classes:!0,styles:!0}]}},t)).then((function(t){window.EDITOR.CKEDITOR[e]=t,t.plugins.get("FileRepository").createUploadAdapter=function(e){return new n(e,RV_MEDIA_URL.media_upload_from_editor,t.t)},t.insertHtml=function(e){var n=t.data.processor.toView(e),r=t.data.toModel(n);t.model.insertContent(r)};var r,o=90*$("#"+e).prop("rows"),a="ckeditor-".concat(e,"-inline");$(t.ui.view.editable.element).addClass(a).after("\n                <style>\n                    .ck-editor__editable_inline {\n                        min-height: ".concat(o-100,"px;\n                        max-height: ").concat(o+100,"px;\n                    }\n                </style>\n            ")),t.model.document.on("change:data",(function(){clearTimeout(r),r=setTimeout((function(){t.updateSourceElement()}),150)})),t.commands._commands.get("mediaEmbed").execute=function(e){t.insertHtml('[media url="'.concat(e,'"][/media]'))}})).catch((function(e){console.error(e)}))}function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(o=r.key,a=void 0,a=function(e,t){if("object"!==l(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===l(a)?a:String(a)),r)}var o,a}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$body=$("body"),this.promptForm=$("#setup-prompt"),this.spinForm=$("#setup-spin"),this.generateModal=$("#auto-content-modal"),this.spinModal=$("#auto-content-spin-modal"),this.$body=$("body"),this.handleGenerateEvents(),this.handleSpinEvents(),this.initEditor()}var t,n,r;return t=e,n=[{key:"initEditor",value:function(){i("preview_content"),i("preview_spin_content")}},{key:"updateModalState",value:function(e,t){var n=e.find(".modal-footer .btn:not([data-bs-dismiss])");t?n.addClass("button-loading").css("pointer-events","none"):n.removeClass("button-loading").css("pointer-events","")}},{key:"loadDefaultPrompt",value:function(e){var t=this,n=t.promptForm,r=(e=new URL(e)).searchParams.get("entity"),o=$("form"),a=["description","content","uri","ip","model","prompt","target_field","target_spin_field","preview_content","target_spin_field","spin-template"],i=o.serializeArray();i.push({name:"entity",value:r}),i=i.filter((function(e){return!a.includes(e.name)})),$.ajax({url:e,type:"POST",data:i,beforeSend:function(){t.updateModalState(t.generateModal,!0),n.hide()},success:function(e){e.error?Botble.showError(e.message):t.handlePromptField(e.data)},error:function(e){t.updateModalState(t.generateModal,!1),n.show(),Botble.handleError(e)},complete:function(){t.updateModalState(t.generateModal,!1),n.show()}})}},{key:"pushContentToTarget",value:function(e,t){t&&(e=e.replace(/(?:\r\n|\r|\n)/g,"<br>"),$("form").find('[name="'+t+'"]').each((function(t,n){var r=n.id||"";EDITOR.CKEDITOR[r]?EDITOR.CKEDITOR[r].setData(e):n.value=e,Botble.showSuccess("Copied content!")})))}},{key:"handleGenerateEvents",value:function(){var e=this,t=e.promptForm,n=t.find("#preview_content"),r=t.find("#target_field"),o=t.find("#prompt_type"),a=t.find("#prompt"),i=$(".btn-auto-content-generate"),l=$("#generate-content"),u=$("#push-content-to-target"),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;$promptTemplates[e]&&a.val($promptTemplates[e].content)};i.on("click",(function(t){t.preventDefault();var n=$(t.currentTarget).data("load-form");e.loadDefaultPrompt(n),e.generateModal.modal("show")})),o.on("change",(function(e){c($(e.currentTarget).val())})),l.on("click",(function(t){t.preventDefault();var r=$(t.currentTarget).data("generate-url"),o=a.val();$.ajax({url:r,type:"POST",data:{prompt:o},beforeSend:function(){e.updateModalState(e.generateModal,!0)},success:function(e){e.error?Botble.showError(e.message):window.EDITOR.CKEDITOR[n.prop("id")].setData(e.data.content)},error:function(e){Botble.handleError(e)},complete:function(){e.updateModalState(e.generateModal,!1)}})})),u.on("click",(function(t){t.preventDefault();var o=window.EDITOR.CKEDITOR[n.prop("id")].getData(),a=r.val();e.pushContentToTarget(o,a)})),c(0)}},{key:"handleSpinEvents",value:function(){var e=this,t=e.spinForm.find("#target_spin_field"),n=e.spinForm.find("#spin_template_title"),r=e.spinForm.find("#spin"),o=e.spinForm.find("#preview_spin_content"),a=$("#spin-content"),i=$("#push-spin-content-to-target"),l=$(".btn-auto-content-spin");e.spinModal.find(".modal-body .loading-spinner").hide();var c=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;$spinTemplates[t]&&r.val(null===(e=$spinTemplates[t])||void 0===e?void 0:e.content)},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="",n=o.prop("id");e&&($("form").find('[name="'+e+'"]').each((function(e,n){var r=n.id||"";t=EDITOR.CKEDITOR[r]?EDITOR.CKEDITOR[r].getData(t):n.value})),EDITOR.CKEDITOR[n]?EDITOR.CKEDITOR[n].setData(t):o.val(t))};l.on("click",(function(e){e.preventDefault();var n=t.val();s(n),$("#auto-content-spin-modal").modal("show")})),a.on("click",(function(e){e.preventDefault();var t,n=function(){var e=r.val();return e.split(/\r?\n/).filter((function(e){return e})).map((function(e){var t,n=null==e||null===(t=e.slice(1,-1))||void 0===t?void 0:t.split("|");return n.filter((function(e){var t;return(e=null===(t=e)||void 0===t?void 0:t.trim()).length})).map((function(e){return null==e?void 0:e.trim()}))}))}(),a=o.val(),i=o.prop("id"),l=u(n);try{for(l.s();!(t=l.n()).done;){var c,s=t.value,p=u(s);try{for(p.s();!(c=p.n()).done;){var d=c.value,f=new RegExp(d,"gi");if(a.match(f)){var m=s[Math.floor(Math.random()*s.length)];a=a.replace(f,m)}}}catch(e){p.e(e)}finally{p.f()}}}catch(e){l.e(e)}finally{l.f()}EDITOR.CKEDITOR[i]?EDITOR.CKEDITOR[i].setData(a):o.val(a)})),i.on("click",(function(n){n.preventDefault();var r=o.val(),a=t.val();e.pushContentToTarget(r,a)})),t.on("change",(function(){var e=t.val();s(e)})),n.on("change",(function(e){c($(this).val())})),c()}},{key:"handlePromptField",value:function(e){var t=$("#extra_items"),n=this.promptForm,r=n.find("#prompt"),o=e.extra_fields;for(var a in!o instanceof Object&&(o={}),t.empty(),o){var i=$('<label class="mb-2 me-3 d-inline-block"><input type="checkbox" value="'.concat(a,'" name="extra_fields[]">').concat(a,"</label>"));t.append(i)}t.find('input[type="checkbox"]').on("change",(function(){var e=n.find("#prompt_type").val(),a=$promptTemplates[e].content,i=a.slice(a),l="";r.val(a),t.find("input:checked").each((function(){l+="\n",l+=o[$(this).val()]||""})),i+=l,r.val(i)}))}}],n&&s(t.prototype,n),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();$(document).ready((function(){new p}))})();